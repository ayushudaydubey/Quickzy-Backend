import{b as g,u as F,j as e,i as D,f as y,y as c}from"./index-49jQCupm.js";import{u as S}from"./index.esm-CYhVOX_g.js";import{u as E}from"./usePagination-DiqoMMzO.js";function L({products:d=[],onEdit:v,onDelete:z}){const{paginatedData:x,currentPage:a,totalPages:l,prev:n,next:h}=E(d,9);return e.jsxs("div",{children:[e.jsx("div",{className:"grid md:grid-cols-3 sm:grid-cols-2 gap-8",children:x.map(s=>e.jsxs("div",{className:"bg-white p-5 rounded-xl border border-zinc-200 shadow-lg flex flex-col hover:shadow-xl transition-shadow duration-300",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto mb-4 pb-2 border-b border-zinc-100",children:Array.isArray(s.images)&&s.images.map((b,p)=>e.jsx("img",{src:b,alt:s.title,loading:"lazy",decoding:"async",className:"h-20 w-20 object-cover rounded-md border border-zinc-300 flex-shrink-0"},p))}),e.jsx("h4",{className:"font-bold text-xl text-zinc-900 line-clamp-1",children:s.title}),e.jsx("p",{className:"text-sm text-zinc-600 line-clamp-2 mt-1 flex-grow",children:s.description}),e.jsxs("p",{className:"mt-3 text-2xl font-black text-zinc-900",children:["₹ ",s.price]}),e.jsxs("p",{className:"mt-1 text-xs text-zinc-500 uppercase tracking-wider",children:["Category: ",e.jsx("span",{className:"font-semibold text-zinc-700",children:s.category||"Uncategorized"})]}),e.jsxs("div",{className:"mt-5 flex justify-between gap-3 pt-4 border-t border-zinc-100",children:[e.jsx("button",{onClick:()=>v(s),className:"flex-1 px-4 py-2 text-zinc-900 border border-zinc-300 rounded-lg hover:bg-zinc-100 transition-colors text-sm font-medium",children:"Edit"}),e.jsx("button",{onClick:()=>z(s._id),className:"w-1/3 px-4 py-2 bg-red-50 text-red-700 border border-red-300 rounded-lg hover:bg-red-100 transition-colors text-sm font-medium",children:"Delete"})]})]},s._id))}),e.jsxs("div",{className:"mt-10 flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 border border-zinc-300 rounded-lg text-zinc-900 hover:bg-zinc-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-semibold",disabled:a<=1,children:"← Prev"}),e.jsxs("div",{className:"text-lg font-medium text-zinc-700",children:["Page ",e.jsx("span",{className:"font-bold",children:a})," of ",e.jsx("span",{className:"font-bold",children:l})]}),e.jsx("button",{onClick:h,className:"px-4 py-2 border border-zinc-300 rounded-lg text-zinc-900 hover:bg-zinc-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-semibold",disabled:a>=l,children:"Next →"})]})]})}const G=()=>{const{register:d,handleSubmit:v,reset:z,setValue:x}=S(),[a,l]=g.useState([]),[n,h]=g.useState(null),[s,b]=g.useState(""),p=F(),[w,C]=g.useState(!0),N=async t=>{var o;try{if(!t){l([]);return}const i=`/products?category=${encodeURIComponent(t)}`,f=((await y.get(i)).data||[]).slice();f.sort((r,m)=>{const j=r.createdAt?new Date(r.createdAt).getTime():0;return(m.createdAt?new Date(m.createdAt).getTime():0)-j}),l(f)}catch(i){c.error("Failed to fetch products."),console.error(((o=i==null?void 0:i.response)==null?void 0:o.data)||i),l([])}};g.useEffect(()=>{(async()=>{var o,i;try{const u=await y.get("/me",{withCredentials:!0});if(!((o=u.data)!=null&&o.admin)&&((i=u.data)==null?void 0:i.role)!=="admin"){c.error("Access denied — admin only."),p("/");return}}catch{c.error("Please login as admin to access this page."),p("/login");return}finally{C(!1)}})()},[p]),g.useEffect(()=>{l([])},[]);const P=async t=>{var o,i,u,f;try{if(!n&&(!t.images||t.images.length===0)){c.error("At least one image is required for new products.");return}const r=new FormData;if(r.append("title",t.title),r.append("description",t.description),r.append("price",t.price),r.append("category",t.category||"Other"),t.images&&t.images.length>0)for(let j=0;j<t.images.length;j++)r.append("images",t.images[j]);n?(await y.put(`/products/${n}`,r,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}}),c.success("Product updated!")):(await y.post("/products",r,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}}),c.success("Product created!")),z(),h(null);const m=t.category||"Other";b(m),N(m)}catch(r){const m=((i=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:i.message)||((f=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:f.error)||r.message;console.error("Product save error:",(r==null?void 0:r.response)||r),c.error(`Action failed: ${m}`)}},k=t=>{h(t._id),x("title",t.title),x("description",t.description),x("price",t.price),x("category",t.category)},A=async t=>{if(window.confirm("Are you sure you want to delete this product?"))try{await y.delete(`/products/${t}`,{withCredentials:!0}),c.success("Product deleted!"),s&&N(s)}catch(o){console.error("Delete error:",(o==null?void 0:o.response)||o),c.error("Failed to delete product.")}};return w?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-zinc-50 text-zinc-900",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 border-4 border-zinc-900 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-lg font-medium",children:"Checking admin access..."})]})}):e.jsx("div",{className:"min-h-screen bg-zinc-50 text-zinc-900 py-12 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx(D,{}),e.jsxs("header",{className:"mb-10 pb-6 border-b border-zinc-300 text-center",children:[e.jsx("h2",{className:"text-4xl font-extrabold tracking-tight text-zinc-900",children:n?"Edit Product":"Create New Product"}),e.jsx("p",{className:"text-md text-zinc-600 mt-2",children:"Manage your inventory and product listings."})]}),e.jsxs("form",{onSubmit:v(P),className:"bg-white p-8 rounded-xl shadow-2xl space-y-6 mb-12 border border-zinc-200",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-6 border-b border-zinc-100 pb-3",children:n?"Product Details":"New Product Entry"}),e.jsx("input",{...d("title",{required:!0}),placeholder:"Product Title",className:"w-full p-3 border border-zinc-300 rounded-lg focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900 focus:outline-none transition-colors"}),e.jsx("textarea",{...d("description",{required:!0}),placeholder:"Detailed Description",className:"w-full p-3 border border-zinc-300 rounded-lg focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900 focus:outline-none transition-colors min-h-[100px]"}),e.jsx("input",{type:"file",...d("images",{required:!n}),accept:"image/*",multiple:!0,className:"w-full p-3 border border-zinc-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-zinc-100 file:text-zinc-700 hover:file:bg-zinc-200"}),e.jsx("input",{type:"number",step:"0.01",...d("price",{required:!0}),placeholder:"Price (e.g., 99.99)",className:"w-full p-3 border border-zinc-300 rounded-lg focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900 focus:outline-none transition-colors"}),e.jsxs("select",{...d("category",{required:!0}),className:"w-full p-3 border border-zinc-300 rounded-lg focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900 focus:outline-none transition-colors",children:[e.jsx("option",{value:"",children:"-- Select Category --"}),e.jsx("option",{value:"Fashion",children:"Fashion / Lifestyle"}),e.jsx("option",{value:"Technology",children:"Technology / Gadgets"}),e.jsx("option",{value:"Home & Living",children:"Home & Living"}),e.jsx("option",{value:"Food & Wellness",children:"Food & Wellness"}),e.jsx("option",{value:"Accessories",children:"Accessories"}),e.jsx("option",{value:"Beauty",children:"Beauty & Grooming"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-zinc-900 text-white px-6 py-3 rounded-lg font-semibold hover:bg-zinc-700 transition-colors shadow-md",children:n?"Update Product":"Create Product"}),n&&e.jsx("button",{type:"button",onClick:()=>{z(),h(null)},className:"flex-1 border border-zinc-300 text-zinc-900 px-6 py-3 rounded-lg font-semibold hover:bg-zinc-100 transition-colors",children:"Cancel Edit"})]})]}),e.jsxs("div",{className:"mb-8 p-6 bg-white rounded-xl shadow-lg border border-zinc-200",children:[e.jsx("label",{className:"block mb-4 font-semibold text-xl border-b border-zinc-100 pb-3",children:"Filter Products by Category"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-stretch sm:items-end",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{htmlFor:"category-select",className:"block mb-2 text-sm font-medium text-zinc-700",children:"Select Category"}),e.jsxs("select",{id:"category-select",value:s,onChange:t=>b(t.target.value),className:"w-full p-3 border border-zinc-300 rounded-lg focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900 focus:outline-none transition-colors bg-white",children:[e.jsx("option",{value:"",children:"-- Select Category --"}),e.jsx("option",{value:"Fashion",children:"Fashion / Lifestyle"}),e.jsx("option",{value:"Technology",children:"Technology / Gadgets"}),e.jsx("option",{value:"Home & Living",children:"Home & Living"}),e.jsx("option",{value:"Food & Wellness",children:"Food & Wellness"}),e.jsx("option",{value:"Accessories",children:"Accessories"}),e.jsx("option",{value:"Beauty",children:"Beauty & Grooming"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsx("button",{onClick:()=>N(s),disabled:!s,className:"px-6 py-3 bg-zinc-900 text-white rounded-lg font-semibold hover:bg-zinc-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Load Products"}),e.jsx("button",{onClick:()=>{b(""),l([])},className:"px-4 py-3 border border-zinc-300 text-zinc-900 rounded-lg hover:bg-zinc-100 transition-colors",children:"Clear"})]})]}),e.jsxs("h3",{className:"text-2xl font-bold mb-6 pt-4 border-t border-zinc-300",children:["Products in: ",s||"—"," (",a.length," items)"]}),e.jsx("div",{children:s&&a.length===0?e.jsxs("div",{className:"text-zinc-600 p-6 bg-white border border-zinc-200 rounded-lg text-center",children:["No products found for **",s,"**."]}):s?e.jsx(L,{products:a,onEdit:k,onDelete:A}):e.jsx("div",{className:"text-zinc-600 p-6 bg-white border border-zinc-200 rounded-lg text-center",children:"Select a category and click **Load Products** to view listings."})})]})})};export{G as default};
