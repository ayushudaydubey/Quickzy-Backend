import{b as l,j as e,i as O,g as E,f as z,y as T}from"./index-JebY-zQ3.js";import{u as U}from"./usePagination-VO3j5G1A.js";const $=t=>new Date(t).toLocaleString(),q=({payment:t,onClose:i})=>{var c,r,d;return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-xl w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Payment Details"}),e.jsx("button",{onClick:i,className:"text-gray-600",children:"Close"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Order ID:"})," ",t.orderId]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Payment ID:"})," ",t.paymentId||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",t.status]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Amount:"})," ₹",t.amount]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Currency:"})," ",t.currency]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created:"})," ",new Date(t.createdAt).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"User:"})," ",((c=t.userId)==null?void 0:c.username)||((r=t.userId)==null?void 0:r.email)||"Guest"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"User Email:"})," ",((d=t.userId)==null?void 0:d.email)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Meta:"})," ",e.jsx("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(t.meta||{},null,2)})]})]})]})}):null},J=()=>{const[t,i]=l.useState([]),[c,r]=l.useState(!0),[d,j]=l.useState(null),[f,w]=l.useState(8),[u,C]=l.useState(""),[o,S]=l.useState("all"),N=async()=>{r(!0);try{const s=await z.get("/admin/payments",{withCredentials:!0});i(s.data.payments||[])}catch(s){console.error("Failed to fetch payments",(s==null?void 0:s.response)||s),T.error("Failed to load payments. Make sure you are an admin."),i([])}finally{r(!1)}};l.useEffect(()=>{N()},[]);const I=t.length,P=t.filter(s=>s.status==="completed").length,k=t.filter(s=>s.status==="failed").length,D=t.filter(s=>s.status==="pending").length,v=l.useMemo(()=>(t||[]).slice().sort((s,a)=>new Date(a.createdAt).getTime()-new Date(s.createdAt).getTime()),[t]),L=l.useMemo(()=>{const s=(u||"").trim().toLowerCase();return v.filter(a=>{var n,y,b;if(o!=="all"&&a.status!==o)return!1;if(!s)return!0;const m=((n=a.product)==null?void 0:n.title)||"",x=(((y=a.userId)==null?void 0:y.username)||((b=a.userId)==null?void 0:b.email)||"").toString();return(a.orderId||"").toLowerCase().includes(s)||m.toLowerCase().includes(s)||x.toLowerCase().includes(s)||a.amount&&a.amount.toString().includes(s)})},[v,u,o]),{paginatedData:A,currentPage:h,totalPages:p,prev:F,next:M,gotoPage:g}=U(L,f);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx(O,{}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Payments"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Overview of customer payments"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsx("input",{value:u,onChange:s=>{C(s.target.value),g(1)},placeholder:"Search order, product or user...",className:"w-full sm:w-72 p-2 border rounded shadow-sm"}),e.jsx("button",{onClick:N,className:"px-3 py-2 bg-gray-100 border rounded",children:"Refresh"})]})]}),e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"bg-white p-3 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total"}),e.jsx("div",{className:"text-xl font-semibold",children:I})]}),e.jsxs("div",{className:"bg-white p-3 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Completed"}),e.jsx("div",{className:"text-xl font-semibold text-green-600",children:P})]}),e.jsxs("div",{className:"bg-white p-3 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Failed"}),e.jsx("div",{className:"text-xl font-semibold text-red-600",children:k})]}),e.jsxs("div",{className:"bg-white p-3 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Pending"}),e.jsx("div",{className:"text-xl font-semibold text-yellow-600",children:D})]})]}),e.jsx("div",{className:"mb-4 flex items-center gap-2",children:["all","completed","pending","failed"].map(s=>e.jsx("button",{onClick:()=>{S(s),g(1)},className:`${o===s?"bg-black text-white":"bg-white text-gray-700"} px-3 py-1 rounded-full border shadow-sm text-sm`,children:s==="all"?"All":s.charAt(0).toUpperCase()+s.slice(1)},s))}),c?e.jsx("div",{className:"text-center mt-12",children:"Loading payments…"}):t.length===0?e.jsx("div",{className:"text-gray-600",children:"No payments found."}):e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:A.map(s=>{var a,m,x,n;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-lg transition transform hover:-translate-y-1 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[(a=s.product)!=null&&a.image?e.jsx("img",{src:s.product.image,alt:s.product.title,className:"w-20 h-20 object-cover rounded-lg"}):e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400",children:"No Image"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Order"}),e.jsx("div",{className:"font-semibold",children:s.orderId}),((m=s.product)==null?void 0:m.title)&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:s.product.title}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:((x=s.userId)==null?void 0:x.username)||((n=s.userId)==null?void 0:n.email)||"Guest"})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${s.status==="completed"?"bg-green-100 text-green-700":s.status==="failed"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:s.status})}),e.jsxs("div",{className:"text-sm text-gray-600",children:["₹",s.amount]}),e.jsx("div",{className:"text-xs text-gray-400",children:$(s.createdAt)}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>j(s),className:"px-3 py-1 border rounded text-sm",children:"Details"}),e.jsx(E,{to:`/admin/payments/${s.orderId}`,className:"px-3 py-1 border rounded text-sm text-gray-600",children:"Open"})]})]})]},s._id)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:F,className:"px-3 py-1 border rounded",disabled:h<=1,children:"Prev"}),e.jsxs("div",{children:["Page ",h," of ",p]}),e.jsx("button",{onClick:M,className:"px-3 py-1 border rounded",disabled:h>=p,children:"Next"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Per page:"}),e.jsxs("select",{value:f,onChange:s=>{w(Number(s.target.value)),g(1)},className:"p-1 border rounded",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:8,children:"8"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]})]})]})]}),d&&e.jsx(q,{payment:d,onClose:()=>j(null)})]})};export{J as default};
