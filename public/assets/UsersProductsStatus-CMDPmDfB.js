import{b as i,j as e,L as U,i as z,f as j,y as m}from"./index-49jQCupm.js";import{u as E}from"./usePagination-DiqoMMzO.js";const D=["pending","paid","shipped","out-for-delivery","delivered","failed"],I=()=>{const[y,u]=i.useState([]),[A,N]=i.useState(!0),[h,o]=i.useState(null),[c,f]=i.useState("all"),[b,C]=i.useState(6),L=async()=>{N(!0);try{const s=await j.get("/admin/orders",{withCredentials:!0});u(s.data.orders||[])}catch(s){console.error("Fetch admin orders error",s),m.error("Failed to load orders. Make sure you are logged in as admin.")}finally{N(!1)}};i.useEffect(()=>{L()},[]);const p=i.useMemo(()=>(y||[]).slice().sort((s,t)=>new Date(t.createdAt).getTime()-new Date(s.createdAt).getTime()),[y]),g=i.useMemo(()=>c==="all"?p:p.filter(s=>s.status===c),[p,c]),{paginatedData:P,currentPage:v,totalPages:w,next:_,prev:O}=E(g,b),S=async(s,t,l=!1,r="")=>{o(s);try{const d=await j.put(`/admin/orders/${s}/status`,{status:t,incrementAttempt:l,note:r},{withCredentials:!0});m.success("Order updated"),u(x=>x.map(n=>n._id===s?d.data.order:n))}catch(d){console.error("Update order status error",d),m.error("Failed to update order")}finally{o(null)}},k=async(s,t)=>{o(s);try{const l=await j.put(`/admin/orders/${s}/delivery`,{expectedDeliveryDate:t},{withCredentials:!0});m.success("Expected delivery date updated"),u(r=>r.map(d=>d._id===s?l.data.order:d))}catch(l){console.error("Update delivery date error",l),m.error("Failed to update delivery date")}finally{o(null)}};return A?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(U,{text:"Loading orders..."})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx(z,{}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Admin Dashboard — Orders"}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsx("button",{className:`px-3 py-1 rounded ${c==="all"?"bg-black text-white":"border"}`,onClick:()=>f("all"),children:"All"}),D.map(s=>e.jsx("button",{className:`px-3 py-1 rounded ${c===s?"bg-black text-white":"border"}`,onClick:()=>f(s),children:s},s))]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("label",{className:"text-sm",children:"Page size:"}),e.jsxs("select",{value:b,onChange:s=>C(Number(s.target.value)),className:"p-1 border rounded",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:6,children:"6"}),e.jsx("option",{value:9,children:"9"}),e.jsx("option",{value:12,children:"12"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",g.length," orders"]})]}),g.length===0?e.jsx("div",{className:"text-gray-600",children:"No orders found for this filter."}):e.jsxs("div",{className:"space-y-4",children:[P.map(s=>{var r,d,x,n;const t=s.productId||{},l=s.userId||{};return e.jsxs("div",{className:"bg-white rounded-xl shadow border p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:Array.isArray(t.images)&&t.images[0]||t.image,alt:t.title,loading:"lazy",decoding:"async",className:"w-20 h-20 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.title}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Order: ",s._id]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Qty: ",s.quantity," · Total: ₹",s.total]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Placed: ",new Date(s.createdAt).toLocaleString()]})]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Customer"}),e.jsx("div",{className:"font-medium",children:l.username||((r=s.customer)==null?void 0:r.name)}),e.jsx("div",{className:"text-sm text-gray-600",children:l.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((d=s.customer)==null?void 0:d.phone)||l.mobile}),e.jsx("div",{className:"text-sm text-gray-600",children:((x=s.customer)==null?void 0:x.address)||`${l.address||""}`})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Delivery"}),e.jsxs("div",{className:"text-sm",children:["Status: ",e.jsx("span",{className:"font-medium",children:s.status})]}),e.jsxs("div",{className:"text-sm",children:["Attempts: ",e.jsx("span",{className:"font-medium",children:s.deliveryAttempts||0})]}),s.deliveredAt&&e.jsxs("div",{className:"text-sm",children:["Delivered at: ",new Date(s.deliveredAt).toLocaleString()]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-xs text-gray-500 block",children:"Expected delivery date"}),e.jsx("input",{type:"date",defaultValue:s.expectedDeliveryDate?new Date(s.expectedDeliveryDate).toISOString().slice(0,10):"",onChange:a=>k(s._id,a.target.value),className:"mt-1 p-1 border rounded text-sm",disabled:h===s._id})]})]})]})}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("select",{value:s.status,onChange:a=>S(s._id,a.target.value,!1),className:"p-2 border rounded",disabled:h===s._id,children:D.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("button",{onClick:()=>S(s._id,s.status,!0,"Delivery attempt recorded"),className:"text-sm bg-gray-100 px-3 py-1 rounded",disabled:h===s._id,children:"+ Record delivery attempt"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Product category"}),e.jsx("div",{className:"text-sm font-medium mt-1",children:t.category||"Uncategorized"})]})]})]}),((n=s.deliveryLogs)==null?void 0:n.length)>0&&e.jsxs("div",{className:"mt-3 text-sm text-gray-700",children:[e.jsx("div",{className:"font-medium",children:"Delivery Logs:"}),e.jsx("ul",{className:"list-disc ml-5",children:s.deliveryLogs.slice().reverse().map((a,T)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:a.status})," — ",a.note||"No note"," ",e.jsxs("span",{className:"text-gray-500",children:["(",new Date(a.timestamp).toLocaleString(),")"]})]},T))})]})]},s._id)}),e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:O,className:"px-3 py-1 border rounded",disabled:v<=1,children:"Prev"}),e.jsxs("div",{className:"space-x-2",children:["Page ",v," of ",w]}),e.jsx("button",{onClick:_,className:"px-3 py-1 border rounded",disabled:v>=w,children:"Next"})]})]})]})};export{I as default};
